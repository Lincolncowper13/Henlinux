name: Minimal VPS Ubuntu with

on:
  push:
    branches:
      - main

jobs:
  create-vps:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ› ï¸ Checkout Repository
      uses: actions/checkout@v3

    - name: ğŸ³ Setup Docker
      uses: docker/setup-buildx-action@v2

    - name: ğŸš€ Start Tailscale with Docker
      run: |
        echo "ğŸ”‘ Starting Tailscale..."
        docker run -d --name tailscale \
          --network host \
          --privileged \
          -e TS_AUTHKEY=${{ secrets.TAILSCALE_AUTHKEY }} \
          tailscale/tailscale:stable tailscaled
        sleep 5
        docker exec tailscale tailscale up --authkey=${{ secrets.TAILSCALE_AUTHKEY }} --accept-routes --accept-dns
        echo "âœ… Tailscale started successfully!"

    - name: ğŸ§ Run Minimal Ubuntu Container
      run: |
        echo "ğŸŒ Creating a minimal Ubuntu container..."
        docker run -d --name ubuntu-vps --network host ubuntu:20.04 /bin/bash -c "apt-get update && apt-get install -y openssh-server && mkdir /var/run/sshd && echo 'root:Henvps13' | chpasswd && sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config && service ssh start && while true; do sleep 30; done"
        echo "âœ… Ubuntu container created successfully!"

    - name: ğŸ“ Display VPS Info
      run: |
        echo "ğŸ” Retrieving Tailscale IP address..."
        TAILSCALE_IP=$(docker exec tailscale tailscale ip -4)
        echo "========================================="
        echo "ğŸ‰ VPS Created Successfully! ğŸ‰"
        echo "ğŸŒ IP Address: $TAILSCALE_IP"
        echo "ğŸ‘¤ Username: root"
        echo "ğŸ”‘ Password: Henvps13"
        echo "========================================="
        echo "ğŸ“‹ Copy this information for your access."
