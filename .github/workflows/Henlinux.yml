name: Minimal VPS Ubuntu with

on:
  push:
    branches:
      - main

jobs:
  create-vps:
    runs-on: ubuntu-latest

    steps:
    - name: 🛠️ Checkout Repository
      uses: actions/checkout@v3

    - name: 🐳 Setup Docker
      uses: docker/setup-buildx-action@v2

    - name: 🚀 Start Tailscale with Docker
      run: |
        echo "🔑 Starting Tailscale..."
        docker run -d --name tailscale \
          --network host \
          --privileged \
          -e TS_AUTHKEY=${{ secrets.TAILSCALE_AUTHKEY }} \
          tailscale/tailscale:stable tailscaled
        sleep 5
        docker exec tailscale tailscale up --authkey=${{ secrets.TAILSCALE_AUTHKEY }} --accept-routes --accept-dns
        echo "✅ Tailscale started successfully!"

    - name: 🐧 Run Minimal Ubuntu Container
      run: |
        echo "🌐 Creating a minimal Ubuntu container..."
        docker run -d --name ubuntu-vps --network host ubuntu:20.04 /bin/bash -c "apt-get update && apt-get install -y openssh-server && mkdir /var/run/sshd && echo 'root:Henvps13' | chpasswd && sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config && service ssh start && while true; do sleep 30; done"
        echo "✅ Ubuntu container created successfully!"

    - name: 📝 Display VPS Info
      run: |
        echo "🔍 Retrieving Tailscale IP address..."
        TAILSCALE_IP=$(docker exec tailscale tailscale ip -4)
        echo "========================================="
        echo "🎉 VPS Created Successfully! 🎉"
        echo "🌐 IP Address: $TAILSCALE_IP"
        echo "👤 Username: root"
        echo "🔑 Password: Henvps13"
        echo "========================================="
        echo "📋 Copy this information for your access."
